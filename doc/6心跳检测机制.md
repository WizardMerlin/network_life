# 心跳检测机制

关键词: 固定时间, 发送包, 查询连接状态, 收包立即返回, (就像)业务层协议

在 TCP 网络通信中, 经常会出现客户端和服务器之间的非正常断开，需要实时检测查询链接状态.

## Heart-Beat线程
常用的解决方法就是在程序中加入心跳机制:  Heart-Beat 线程

在接收和发送数据时个人设计一个守护进程(线程), 定时发送 Heart-Beat 包, 客户端/服务器收到该小包后, 立刻返回相应的包即可检测对方是否实时在线.

该方法的好处是通用, 但缺点就是会改变现有的通讯协议! 

## 业务层心跳包
大家一般都是使用业务层心跳来处理, 主要是灵活可控.



## 探测分节 
UNIX 网络编程不推荐使用 SO_KEEPALIVE 来做心跳检测(反馈时间太长, 9个探测分节大概持续2小时多; 并且还要用setsockopt设置), 
还是在业务层以心跳包做检测比较好, 也方便控制.